{% extends "base.html" %}

{% block title %}棋譜読み込み方法の例{% endblock %}

{% block head %}
<style>
.kifu-example {
    margin-bottom: 2rem;
    padding: 1rem;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
}

.kifu-board {
    margin: 1rem 0;
    min-height: 200px;
}

.method-title {
    color: #0d6efd;
    font-weight: bold;
    margin-bottom: 0.5rem;
}

.code-block {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    padding: 1rem;
    margin: 0.5rem 0;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    overflow-x: auto;
}

.btn-group-example {
    margin: 0.5rem 0;
}
</style>
{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">棋譜読み込み方法の例</h1>
            <p class="lead">KifuForJSを使用した様々な棋譜読み込み方法を紹介します。</p>
        </div>
    </div>

    <!-- 方法1: タグ方式 -->
    <div class="kifu-example">
        <h3 class="method-title">方法1: タグ方式</h3>
        <p>棋譜を<code>&lt;script type="text/kifu"&gt;</code>タグの中身として書きます。</p>
        
        <div class="code-block">
&lt;script type="text/kifu"&gt;
後手の持駒：飛二　金四　桂四　香四　歩十八
９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+
|v香v桂v銀v金v王v金v銀v桂v香|一
| ・v飛 ・ ・ ・ ・ ・v角 ・|二
|v歩v歩v歩v歩v歩v歩v歩v歩v歩|三
| ・ ・ ・ ・ ・ ・ ・ ・ ・|四
| ・ ・ ・ ・ ・ ・ ・ ・ ・|五
| ・ ・ ・ ・ ・ ・ ・ ・ ・|六
| 歩 歩 歩 歩 歩 歩 歩 歩 歩|七
| ・ 角 ・ ・ ・ ・ ・ 飛 ・|八
| 香 桂 銀 金 玉 金 銀 桂 香|九
+---------------------------+
先手の持駒：なし
手合割：平手
先手：吉永
後手：島田
手数----指手---------消費時間--
   1 ７六歩(77)        ( 0:01/00:00:01)
   2 ３四歩(33)        ( 0:01/00:00:01)
   3 ６六歩(67)        ( 0:04/00:00:05)
   4 ９四歩(93)        ( 0:01/00:00:02)
   5 ９六歩(97)        ( 0:01/00:00:06)
&lt;/script&gt;
        </div>

        <div class="kifu-board" id="board-tag-method"></div>
    </div>

    <!-- 方法2: data-kifu属性方式 -->
    <div class="kifu-example">
        <h3 class="method-title">方法2: data-kifu属性方式</h3>
        <p>改行が含まれない場合は、<code>data-kifu</code>属性に指定することもできます。</p>
        
        <div class="code-block">
&lt;script type="text/kifu" data-kifu="▲７六歩 △３四歩 ▲６六歩 △９四歩 ▲９六歩"&gt;&lt;/script&gt;
        </div>

        <div class="kifu-board" id="board-data-attr-method"></div>
    </div>

    <!-- 方法3: インデント自動処理 -->
    <div class="kifu-example">
        <h3 class="method-title">方法3: インデント自動処理</h3>
        <p>タグの中身にインデントが含まれていても適切に処理されます。</p>
        
        <div class="code-block">
&lt;script type="text/kifu"&gt;
  # KIF形式棋譜ファイル
  # Generated by Shogidokoro
  後手の持駒：飛　金三　銀三　桂二　香四　歩十三
  ９ ８ ７ ６ ５ ４ ３ ２ １
  +---------------------------+
  | ・ ・ ・ ・ 馬 ・ ・v桂 ・|一
  | ・ ・ ・ ・ ・ ・ ・v玉 ・|二
  | ・ ・ ・ ・ ・ ・v歩v歩 ・|三
  | ・ ・ ・ ・ ・ ・ ・v金v歩|四
  | ・ ・ ・ ・ 歩 ・ ・ ・ 歩|五
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|七
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|八
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|九
  +---------------------------+
  先手の持駒：飛　角　銀　桂
  先手：
  後手：
  手数----指手---------消費時間--
  1 ５二飛打      (00:31 / 00:00:31)
  2 ３二金打      (00:00 / 00:00:00)
  3 ３一角打      (00:00 / 00:00:31)
  4 同　玉(22)    (00:00 / 00:00:00)
&lt;/script&gt;
        </div>

        <div class="kifu-board" id="board-indented-method"></div>
    </div>

    <!-- 方法4: JavaScript関数方式 -->
    <div class="kifu-example">
        <h3 class="method-title">方法4: JavaScript関数方式</h3>
        <p>プログラムで棋譜を読み込む方法です。</p>
        
        <div class="code-block">
// 棋譜文字列から読み込み
KifuUtils.loadFromString(kifuString, 'board-js-method');

// ファイルから読み込み
KifuUtils.loadFromFile('/static/kifu/great-tsume.kif', 'board-js-method');

// URLから読み込み
KifuUtils.loadFromUrl('https://example.com/kifu.kif', 'board-js-method');
        </div>

        <div class="btn-group-example">
            <button class="btn btn-primary" onclick="loadExampleKifu()">例の棋譜を読み込み</button>
            <button class="btn btn-secondary" onclick="loadFromFile()">ファイルから読み込み</button>
            <button class="btn btn-info" onclick="loadFromUrl()">URLから読み込み</button>
        </div>

        <div class="kifu-board" id="board-js-method"></div>
    </div>

    <!-- 方法5: 棋譜マネージャー方式 -->
    <div class="kifu-example">
        <h3 class="method-title">方法5: 棋譜マネージャー方式</h3>
        <p>複数の棋譜ボードを管理する方法です。</p>
        
        <div class="code-block">
// 棋譜マネージャーの使用
const manager = new KifuManager();
manager.createBoard('board-manager-1');
manager.createBoard('board-manager-2');
manager.setCurrentBoard('board-manager-1');
manager.loadToCurrentBoard(kifuString);
        </div>

        <div class="btn-group-example">
            <button class="btn btn-success" onclick="createManagerBoards()">ボードを作成</button>
            <button class="btn btn-warning" onclick="loadToManagerBoard()">棋譜を読み込み</button>
            <button class="btn btn-danger" onclick="clearManagerBoards()">ボードをクリア</button>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h5>ボード1</h5>
                <div class="kifu-board" id="board-manager-1"></div>
            </div>
            <div class="col-md-6">
                <h5>ボード2</h5>
                <div class="kifu-board" id="board-manager-2"></div>
            </div>
        </div>
    </div>

    <!-- 方法6: フォーマッター方式 -->
    <div class="kifu-example">
        <h3 class="method-title">方法6: フォーマッター方式</h3>
        <p>棋譜の表示形式を変更する方法です。</p>
        
        <div class="btn-group-example">
            <button class="btn btn-outline-primary" onclick="showCompactFormat()">簡潔形式</button>
            <button class="btn btn-outline-secondary" onclick="showDetailedFormat()">詳細形式</button>
            <button class="btn btn-outline-info" onclick="showHTMLFormat()">HTML形式</button>
        </div>

        <div id="formatter-output" class="code-block" style="min-height: 100px;">
            ボタンをクリックして棋譜の形式を変更してください。
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- 方法1: タグ方式の例 -->
<script type="text/kifu">
後手の持駒：飛二　金四　桂四　香四　歩十八
９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+
|v香v桂v銀v金v王v金v銀v桂v香|一
| ・v飛 ・ ・ ・ ・ ・v角 ・|二
|v歩v歩v歩v歩v歩v歩v歩v歩v歩|三
| ・ ・ ・ ・ ・ ・ ・ ・ ・|四
| ・ ・ ・ ・ ・ ・ ・ ・ ・|五
| ・ ・ ・ ・ ・ ・ ・ ・ ・|六
| 歩 歩 歩 歩 歩 歩 歩 歩 歩|七
| ・ 角 ・ ・ ・ ・ ・ 飛 ・|八
| 香 桂 銀 金 玉 金 銀 桂 香|九
+---------------------------+
先手の持駒：なし
手合割：平手
先手：吉永
後手：島田
手数----指手---------消費時間--
   1 ７六歩(77)        ( 0:01/00:00:01)
   2 ３四歩(33)        ( 0:01/00:00:01)
   3 ６六歩(67)        ( 0:04/00:00:05)
   4 ９四歩(93)        ( 0:01/00:00:02)
   5 ９六歩(97)        ( 0:01/00:00:06)
   6 ６二銀(71)        ( 0:09/00:00:11)
   7 ２六歩(27)        ( 0:01/00:00:07)
   8 ４四歩(43)        ( 0:04/00:00:15)
   9 ４八銀(39)        ( 0:01/00:00:08)
  10 ４二銀(31)        ( 0:04/00:00:19)
</script>

<!-- 方法2: data-kifu属性方式の例 -->
<script type="text/kifu" data-kifu="▲７六歩 △３四歩 ▲６六歩 △９四歩 ▲９六歩"></script>

<!-- 方法3: インデント自動処理の例 -->
<script type="text/kifu">
  # KIF形式棋譜ファイル
  # Generated by Shogidokoro
  後手の持駒：飛　金三　銀三　桂二　香四　歩十三
  ９ ８ ７ ６ ５ ４ ３ ２ １
  +---------------------------+
  | ・ ・ ・ ・ 馬 ・ ・v桂 ・|一
  | ・ ・ ・ ・ ・ ・ ・v玉 ・|二
  | ・ ・ ・ ・ ・ ・v歩v歩 ・|三
  | ・ ・ ・ ・ ・ ・ ・v金v歩|四
  | ・ ・ ・ ・ 歩 ・ ・ ・ 歩|五
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|七
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|八
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|九
  +---------------------------+
  先手の持駒：飛　角　銀　桂
  先手：
  後手：
  手数----指手---------消費時間--
  1 ５二飛打      (00:31 / 00:00:31)
  2 ３二金打      (00:00 / 00:00:00)
  3 ３一角打      (00:00 / 00:00:31)
  4 同　玉(22)    (00:00 / 00:00:00)
</script>

<script>
// 例の棋譜データ
const exampleKifu = `後手の持駒：飛二　金四　桂四　香四　歩十八
９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+
|v香v桂v銀v金v王v金v銀v桂v香|一
| ・v飛 ・ ・ ・ ・ ・v角 ・|二
|v歩v歩v歩v歩v歩v歩v歩v歩v歩|三
| ・ ・ ・ ・ ・ ・ ・ ・ ・|四
| ・ ・ ・ ・ ・ ・ ・ ・ ・|五
| ・ ・ ・ ・ ・ ・ ・ ・ ・|六
| 歩 歩 歩 歩 歩 歩 歩 歩 歩|七
| ・ 角 ・ ・ ・ ・ ・ 飛 ・|八
| 香 桂 銀 金 玉 金 銀 桂 香|九
+---------------------------+
先手の持駒：なし
手合割：平手
先手：吉永
後手：島田
手数----指手---------消費時間--
   1 ７六歩(77)        ( 0:01/00:00:01)
   2 ３四歩(33)        ( 0:01/00:00:01)
   3 ６六歩(67)        ( 0:04/00:00:05)
   4 ９四歩(93)        ( 0:01/00:00:02)
   5 ９六歩(97)        ( 0:01/00:00:06)
   6 ６二銀(71)        ( 0:09/00:00:11)
   7 ２六歩(27)        ( 0:01/00:00:07)
   8 ４四歩(43)        ( 0:04/00:00:15)
   9 ４八銀(39)        ( 0:01/00:00:08)
  10 ４二銀(31)        ( 0:04/00:00:19)`;

// 方法4: JavaScript関数方式の例
function loadExampleKifu() {
    KifuUtils.loadFromString(exampleKifu, 'board-js-method');
}

function loadFromFile() {
    KifuUtils.loadFromFile('/static/kifu/great-tsume.kif', 'board-js-method');
}

function loadFromUrl() {
    // 実際のURLに置き換えてください
    alert('URLから読み込む場合は、実際の棋譜URLを指定してください。');
}

// 方法5: 棋譜マネージャー方式の例
let managerBoards = [];

function createManagerBoards() {
    managerBoards = [];
    managerBoards.push(kifuManager.createBoard('board-manager-1'));
    managerBoards.push(kifuManager.createBoard('board-manager-2'));
    kifuManager.setCurrentBoard('board-manager-1');
    alert('ボードを作成しました');
}

function loadToManagerBoard() {
    if (managerBoards.length > 0) {
        kifuManager.loadToCurrentBoard(exampleKifu);
        alert('棋譜を読み込みました');
    } else {
        alert('まずボードを作成してください');
    }
}

function clearManagerBoards() {
    kifuManager.removeBoard('board-manager-1');
    kifuManager.removeBoard('board-manager-2');
    managerBoards = [];
    document.getElementById('board-manager-1').innerHTML = '';
    document.getElementById('board-manager-2').innerHTML = '';
    alert('ボードをクリアしました');
}

// 方法6: フォーマッター方式の例
function showCompactFormat() {
    const output = KifuFormatter.toCompact(exampleKifu);
    document.getElementById('formatter-output').innerHTML = `<pre>${output}</pre>`;
}

function showDetailedFormat() {
    const output = KifuFormatter.toDetailed(exampleKifu);
    document.getElementById('formatter-output').innerHTML = `<pre>${output}</pre>`;
}

function showHTMLFormat() {
    const output = KifuFormatter.toHTML(exampleKifu);
    document.getElementById('formatter-output').innerHTML = output;
}

// ページ読み込み時の初期化
document.addEventListener('DOMContentLoaded', function() {
    // 方法4の例を自動読み込み
    loadExampleKifu();
});
</script>
{% endblock %}
