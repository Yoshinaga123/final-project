{% extends "base.html" %}
{% block title %}{{ image.original_filename or image.filename }} - 画像詳細{% endblock %}

{% block head %}
<style>
    .image-detail-container {
        margin-top: 20px;
    }
    
    .image-detail-card {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    
    .image-detail-header {
        padding: 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .image-main {
        text-align: center;
        padding: 20px;
    }
    
    .image-display {
        max-width: 100%;
        max-height: 600px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .image-info-section {
        padding: 20px;
        border-top: 1px solid #eee;
    }
    
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }
    
    .info-group {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
    }
    
    .info-label {
        font-weight: bold;
        color: #555;
        font-size: 14px;
        margin-bottom: 5px;
    }
    
    .info-value {
        color: #333;
        font-size: 16px;
    }
    
    .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #007bff;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: bold;
    }
    
    .user-details h5 {
        margin: 0;
        color: #333;
    }
    
    .user-details small {
        color: #666;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .breadcrumb-nav {
        margin-bottom: 20px;
    }
    
    .no-image {
        color: #999;
        font-style: italic;
        padding: 60px;
        text-align: center;
    }
    
    /* ダークモード対応 */
    body.theme-dark .image-detail-card {
        background-color: var(--theme-bg-secondary);
        border-color: var(--theme-border);
    }
    
    body.theme-dark .image-detail-header,
    body.theme-dark .image-info-section {
        border-color: var(--theme-border);
    }
    
    body.theme-dark .info-group {
        background-color: var(--theme-bg-primary);
    }
    
    body.theme-dark .info-label {
        color: var(--theme-text-secondary);
    }
    
    body.theme-dark .info-value,
    body.theme-dark .user-details h5 {
        color: var(--theme-text-primary);
    }
    
    body.theme-dark .user-details small {
        color: var(--theme-text-secondary);
    }
</style>
{% endblock %}

{% block body %}
<div class="container image-detail-container">
    <!-- パンくずナビ -->
    <nav aria-label="breadcrumb" class="breadcrumb-nav">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('detector.index') }}">物体検知</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('detector.gallery') }}">ギャラリー</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ image.original_filename or image.filename }}</li>
        </ol>
    </nav>

    <div class="image-detail-card">
        <!-- ヘッダー -->
        <div class="image-detail-header">
            <div>
                <h3><i class="fas fa-image"></i> {{ image.original_filename or image.filename }}</h3>
                <small class="text-muted">
                    <i class="fas fa-calendar"></i> {{ image.uploaded_at.strftime('%Y年%m月%d日 %H:%M') }}
                </small>
            </div>
            <div class="action-buttons">
                {% if current_user.is_authenticated and current_user.id == image.user_id %}
                <form method="POST" action="{{ url_for('detector.delete_image', image_id=image.id) }}" 
                      style="display: inline;" onsubmit="return confirm('この画像を削除しますか？')">
                    <button type="submit" class="btn btn-outline-danger">
                        <i class="fas fa-trash"></i> 削除
                    </button>
                </form>
                {% endif %}
                <a href="{{ url_for('detector.gallery') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-images"></i> ギャラリーに戻る
                </a>
            </div>
        </div>

        <!-- 画像表示 -->
        <div class="image-main">
            {% if image.image_path %}
            <img src="{{ url_for('static', filename='uploads/' + image.filename) }}" 
                 class="image-display" 
                 alt="{{ image.original_filename }}"
                 onerror="this.parentElement.innerHTML='<div class=\'no-image\'><i class=\'fas fa-exclamation-triangle\'></i><br>画像が見つかりません</div>'">
            {% else %}
            <div class="no-image">
                <i class="fas fa-exclamation-triangle"></i><br>
                画像が見つかりません
            </div>
            {% endif %}
        </div>

        <!-- 画像情報 -->
        <div class="image-info-section">
            <div class="info-grid">
                <!-- ファイル情報 -->
                <div class="info-group">
                    <div class="info-label">ファイル情報</div>
                    <div class="info-value">
                        <strong>ファイル名:</strong> {{ image.filename }}<br>
                        <strong>元ファイル名:</strong> {{ image.original_filename or '不明' }}<br>
                        <strong>パス:</strong> <code>{{ image.image_path }}</code>
                    </div>
                </div>

                <!-- アップロード情報 -->
                <div class="info-group">
                    <div class="info-label">アップロード情報</div>
                    <div class="info-value">
                        <strong>アップロード日時:</strong><br>
                        {{ image.uploaded_at.strftime('%Y年%m月%d日 %H:%M:%S') }}<br>
                        <small class="text-muted">
                            ({{ (now() - image.uploaded_at).days }}日前)
                        </small>
                    </div>
                </div>

                <!-- ステータス情報 -->
                <div class="info-group">
                    <div class="info-label">ステータス</div>
                    <div class="info-value">
                        <span class="badge bg-{{ 'success' if image.is_active else 'secondary' }}">
                            {{ 'アクティブ' if image.is_active else '非アクティブ' }}
                        </span>
                        <span class="badge bg-{{ 'success' if not image.is_deleted else 'danger' }}">
                            {{ '正常' if not image.is_deleted else '削除済み' }}
                        </span>
                    </div>
                </div>

                <!-- ユーザー情報 -->
                <div class="info-group">
                    <div class="info-label">アップロードユーザー</div>
                    <div class="user-info">
                        <div class="user-avatar">{{ user.username[0].upper() }}</div>
                        <div class="user-details">
                            <h5>{{ user.username }}</h5>
                            <small>{{ user.email }}</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
